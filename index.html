<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Shadows+Into+Light"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <title>Hem</title>
  </head>
  <body>
    <!------------ navbar -------->
    <nav
      class="navbar navbar-expand-md navbar-dark fixed-top bg-dark"
      style="background-color:#54B7B2 !important; box-shadow: 0px 5px 5px 0px #928d8d !important; height: 60px;"
    >
      <a id="store-name" class="navbar-brand" href="#">LIFE HACKS</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarCollapse"
        aria-controls="navbarCollapse"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Products</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">About Us</a>
          </li>
        </ul>
      </div>

      <!-------- varukorg --------->

      <div class="btn-group">
        <i id="basket-icon" class="fa fa-shopping-basket" onclick="on()"></i>
        <div id="antal-produkter"></div>

        <div id="overlay">
          <table class="table"></table>
          <span id="total-pris"></span>
          <button class="clear-ls">Clear all</button>
          <a href="./bestallning.html" type="button">Go till kassan</a>
        </div>
      </div>
    </nav>

    <!-------- banner image -------->

    <div class="banner" onclick="off()">
      <!-- <img src="images/banner.jpg" alt="banner"> -->
      <img src="images/banner/banner-longJPEG-letters.jpg" alt="banner" />
    </div>

    <!---------- products json  --------->

    <h4 class="title4">Pick and choose and be the best YOU !</h4>
    <div id="container1"></div>
    <div class="jsonlink">
      <a href="./products.json">JSON fil länk</a>
    </div>

    <!---------- Footer ---------->

    <!-- Footer -->
    <footer id="footer" class="page-footer font-small teal pt-4">
      <!-- Footer Text -->
      <div class="container-fluid text-center text-md-left">
        <!-- Grid row -->
        <div class="row">
          <!-- Grid column -->
          <div id="footer-content" class="col-md-6 mt-md-0 mt-3">
            <!-- Content -->
            <h5 class="text-uppercase">Footer text 1</h5>
            <p>
              Lorem ipsum dolor sit, amet consectetur adipisicing elit. Expedita
              sapiente sint, nulla, nihil repudiandae commodi voluptatibus
              corrupti animi sequi aliquid magnam debitis, maxime quam
              recusandae harum esse fugiat. Itaque, culpa?
            </p>
          </div>
          <!-- Grid column -->

          <hr class="clearfix w-100 d-md-none pb-3" />

          <!-- Grid column -->
          <div id="footer-content" class="col-md-6 mb-md-0 mb-3">
            <!-- Content -->
            <h5 class="text-uppercase">Footer text 2</h5>
            <p>
              Lorem ipsum, dolor sit amet consectetur adipisicing elit. Optio
              deserunt fuga perferendis modi earum commodi aperiam temporibus
              quod nulla nesciunt aliquid debitis ullam omnis quos ipsam,
              aspernatur id excepturi hic.
            </p>
          </div>
          <!-- Grid column -->

          <div class="github-icon">
            <i class="fa fa-github"></i>
          </div>
        </div>
        <!-- Grid row -->
      </div>
    </footer>

    <!-- Copyright -->
    <div id="copyright" class="footer-copyright text-center py-3">
      © 2018 Copyright:
      <a href="https://mdbootstrap.com/education/bootstrap/">
        MDBootstrap.com</a
      >
    </div>

    <!-------- js files --------->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <!-- <script src="js/index.js"></script> -->
    <!-- <script src="js/bestallning.js"></script> -->

    <!-- <script src="js/bestallning.js"></script> -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <script>
      function on() {
        document.getElementById("overlay").style.display = "block";
      }

      function off() {
        document.getElementById("overlay").style.display = "none";
      }

      // index.html

      function load(url, cb) {
        let xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function() {
          if (this.readyState === 4 && this.status === 200) {
            cb(this);
          }
        };
        xhr.open("GET", url, true);
        xhr.send();
      }

      load("./products.json", demoCallback);

      function demoCallback(xhr) {
        const products = JSON.parse(xhr.responseText);

        let item = products.items;
        let output1 = "";
        for (let i = 0; i < item.length; i++) {
          output1 +=
            "<div id='card' class='card' style='width: 12rem;'>" +
            "<img src=" +
            item[i].bild +
            ">" +
            "<div class='card-body' style='padding: 5px !important;'>" +
            "<h5 id='title' class='card-title'>" +
            item[i].title +
            "</h5>" +
            "<h6 class='card-text'>" +
            item[i].beskrivning +
            "</h6>" +
            "<h6 id='pris' class='card-text'>" +
            item[i].pris +
            "</h6>" +
            "<a href='./index.html' class='index btn btn-primary'><div><i class='fa fa-shopping-basket'></i></div>&nbsp;Buy</a></div></div>";
        }
        document.getElementById("container1").innerHTML = output1;

        let a = document.getElementsByClassName("index");

        for (let i = 0; i < item.length; i++) {
          a[i].addEventListener("click", function() {
            localStorage.setItem("orderItem" + i, JSON.stringify(item[i]));
            antalProdukter();
          });
        }
      }

      // beräkna antal produkter i varukorgen
      function antalProdukter() {
        let antal = 0;
        let x;
        Object.keys(localStorage).forEach(function(key) {
          let obj3 = JSON.parse(localStorage.getItem(`${key}`));
          x = parseInt(obj3.antal);
          antal += x;
        });
        document.getElementById("antal-produkter").innerHTML = antal;
      }

      antalProdukter();

      // betallningar.html

      $(document).ready(function() {
        if (localStorage.length === 0) {
          $(".clear-ls")
            .css("display", "none")
            .after("<span>Din varukorg är tom</span>");

          $("#total-pris").css("display", "none");
        } else {
          const table = document.getElementsByClassName("table");

          Object.keys(localStorage).forEach(function(key) {
            // läggs till produkter till varukorgen
            let obj = JSON.parse(localStorage.getItem(`${key}`));

            let bild = obj.bild;
            let title = obj.title;
            let pris = obj.pris;
            let antal = obj.antal;
            let totalPris = obj.totalPris;

            let output2 =
              "<td><img src=" +
              bild +
              "></td>" +
              "<td><h3>" +
              title +
              "</h3></td>" +
              `<td><a href='#' type="button" class="total" id="minus` +
              `${key}` +
              `">-</a><span class="antal" id="antal` +
              `${key}` +
              `">` +
              antal +
              `</span><a href='#' type="button" class="total" id="plus` +
              `${key}` +
              `">+</a></td><span id="tprice` +
              `${key}` +
              `">` +
              totalPris +
              `</span><td><a class='delete' id='delete-product` +
              `${key}` +
              `'><i id="trash-icon" class="fa fa-trash-o"></i></button></td>`;

            // anropar funktionen tableMaker som skapar rader och för varje vald produkt
            tableMaker(output2);

            // köpa flera produkter av samma sort och beräkna pris
            $(`#plus${key}`).on("click", function() {
              x = document.getElementById(`antal${key}`).innerHTML;
              x = ++x;
              document.getElementById(`antal${key}`).innerHTML = x;
              document.getElementById(`tprice${key}`).innerHTML =
                "$ " + totalAktuellProdukt(x);
              obj.antal = x;
              localStorage.setItem(`${key}`, JSON.stringify(obj));

              //anropar funktionen total() som beräknar total pris när man ändrar antal produkter
              total();
              antalProdukter();
            });
            $(`#minus${key}`).on("click", function() {
              x = document.getElementById(`antal${key}`).innerHTML;
              x = --x;
              if (x >= 1) {
                document.getElementById(`antal${key}`).innerHTML = x;
                document.getElementById(`tprice${key}`).innerHTML =
                  "$ " + totalAktuellProdukt(x);
                obj.antal = x;
                localStorage.setItem(`${key}`, JSON.stringify(obj));
              }

              //anropar funktionen total() som beräknar total pris när man ändrar antal produkter
              total();
              antalProdukter();
            });

            // beräkna total pris för bara en produkt
            function totalAktuellProdukt(antal) {
              let tprice = antal * pris;
              obj.totalPris = tprice;
              return tprice;
            }

            // delete produkter (en i taget)
            $(`#delete-product${key}`).on("click", function() {
              localStorage.removeItem(`orderItem${key}`);
              $(this)
                .parents("tr")
                .remove();
              localStorage.removeItem(key);
              if (localStorage.length === 0) {
                $(".clear-ls")
                  .css("display", "none")
                  .after("<span>Din varukorg är tom</span>");

                $("#total-pris").css("display", "none");
              }
            });
          });

          // funktionen tableMaker lägger till rader med olika produkter till varukorgen och beställning sida
          function tableMaker(obj) {
            const tr = document.createElement("tr");

            for (let i = 0; i < table.length; i++) {
              tr.innerHTML = obj;
              table[i].appendChild(tr);
            }
          }
        }

        // beräkna total pris att betala
        function total() {
          let nyTotalPris = 0;
          let x;
          Object.keys(localStorage).forEach(function(key) {
            let obj2 = JSON.parse(localStorage.getItem(`${key}`));
            x = parseInt(obj2.totalPris);
            nyTotalPris += x;
          });
          document.getElementById("total-pris").innerHTML = nyTotalPris;
        }

        total();

        // beräkna total pris när man raderar en objekt på pris att betala
        $(".delete").on("click", function() {
          total();
          antalProdukter();
        });

        // beräkna antal produkter i varukorgen
        function antalProdukter() {
          let antal = 0;
          let x;
          Object.keys(localStorage).forEach(function(key) {
            let obj3 = JSON.parse(localStorage.getItem(`${key}`));
            x = parseInt(obj3.antal);
            antal += x;
          });
          document.getElementById("antal-produkter").innerHTML = antal;
        }

        antalProdukter();

        // delete alla produkter
        $(".clear-ls").on("click", function() {
          $(".table").remove();
          localStorage.clear();
          antalProdukter();

          $(this)
            .css("display", "none")
            .after("<span>Din varukorg är tom</span>");

          $("#total-pris").css("display", "none");
        });
      });
    </script>
  </body>
</html>
